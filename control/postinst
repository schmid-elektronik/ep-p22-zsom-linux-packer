#!/bin/bash

# install proprieary modules, version is set by build_opkg.sh
KERNEL_VERSION=4.14.146-rt67-ni-g9cd7a29748a1

# run the ni versioning tools
source /usr/local/natinst/tools/versioning_utils.sh
setup_versioning_env
test $? -ne 0 && echo "### failed to setup setup_versioning_env tools" && exit 1
versioning_call /usr/local/natinst/nikal/bin/updateNIDrivers $KERNEL_VERSION
test $? -ne 0 && echo "### failed to run versioning tools" && exit 1

# enable interface in ni subsystem
/usr/local/natinst/bin/nirtcfg --set section=wlan0,token=radioenabled,value=1
/usr/local/natinst/bin/nirtcfg --set section=wlan0,token=dhcpenabled,value=1
/usr/local/natinst/bin/nirtcfg --set section=wlan0,token=linklocalenabled,value=1
/usr/local/natinst/bin/nirtcfg --set section=wlan0,token=adaptermode,value=1
/usr/local/natinst/bin/nirtcfg --set section=wlan0,token=dhcpserverenabled,value=1
/usr/local/natinst/bin/nirtcfg --set section=wlan0,token=Mode,value=TCPIP

exit 0
